
<!DOCTYPE html>
<html ng-app="stampCollection">
	<head>
		<title>Stamp Collection Demo</title>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
		<!-- Latest compiled and minified CSS -->
		<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.11.1/bootstrap-table.min.css">

		<!-- Latest compiled and minified JavaScript -->
		<script src="//cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.11.1/bootstrap-table.min.js"></script>
		<style>
			.table {word-wrap:break-word;}
			.th-inner {
				text-align: center;
			}
		</style>
	</head>
	<body>
		<div id="navbar" class="navbar navbar-default">
     			<ul class="nav navbar-nav">
					<li><a href="#home">Home</a></li>
					<li><a href="#view">View Local Stamps</a></li>
					<li><a href="#search">Search</a></li>
					<li><a href="#create">Create</a></li>
					<li><a href="#connections">Connections</a></li>
				</ul>
		</div>
		<div class="container" align="right">
			<p style="display: inline;">IDENTITY: </p><p style="max-width: 30em;display: inline" id="identity" class="form-control"></p>
		</div>
			<section ng-view></section>
	</body>
	<script type="application/javascript" src="functions.js"></script>
	<script type="application/javascript" src="index.min.js"></script>

	<script type="text/ng-template" id="index.html">
		<div align="center" class="container">
		<h1 align> Stamp Collection </h1>
			<p align="center"> This demo is a peer to peer stamp collection based on the DS2 network model using native browser APIs. </p>
		<button id="injectButton" onclick="injectData();$('#dataChanged')[0].innerHTML='Injected 10 more data items'" class="btn btn-primary">Inject Data</button>
		<button id="resetButton" onclick="window.indexedDB.deleteDatabase('stamps');node = new MongoIdbDs2('stamps', 'hash, name, country, year');node.start();$('#dataChanged')[0].innerHTML='Deleted all data items and reset connections '" class="btn btn-primary">Reset Data and Connections</button>
		<p id="dataChanged"></p>
			<div align="left">
				<br><br><br>
				<p>This website was built using:
				<ol>
					<li> AngularJs for routing and templating so that it acts like a SPA.</li>
					<li> JQuery for DOM and CSS manipulation.</li>
					<li> Bootstrap for tables and visuals.</li>
				</ol>
				What can you do?
				<ol>
					<li> Upload your own stamp collection.</li>
					<li> Get your identity from the top right of any page and share it with others, so they can connect to you and view your stamp collection.</li>
					<li> Connect to other stamp collectors.</li>
					<li> Search for stamps within your connected stamp collectors.</li>
					<li> Inject random data into this demo from the home page. (Unfortunately, the injected photos are not actually stamps but are simply random placeholders.</li>
					<li> Reset the data in this demo from the home page.</li></ol>
				</p>
			</div>
		</div>
	</script>

	<script type="text/ng-template" id="create.html">
		<div class="container">
			<h1>Create</h1>
			<form id="createForm">
				<div class="form-group">
					<label for="name_create">Name</label>
					<input type="text" class="form-control" id="name_create" placeholder="Enter Stamp Name" required>
					<br>
					<label for="country_create">Country Of Origin</label>
					<input type="text" class="form-control" id="country_create" placeholder="Enter Country of Origin" required>
					<br>
					<label for="year_create">Year Of Origin</label>
					<input type="number" min="100" max="2017" class="form-control" id="year_create" placeholder="Enter Year Of Origin" required>
					<br>
					<label for="file_create"  class="custom-file">Image</label>
						<input type="file" id="file_create" class="form-control custom-file-input" required>
						<span class="custom-file-control"></span>
				</div>
				<button type="submit" class="btn btn-primary">Submit</button>
				<button type="reset" class="btn btn-primary">Reset</button>
			</form>
		</div>
	</script>

	<script type="text/ng-template" id="view.html">

		<div class="container">
			<img id="photo" width="200" height="200" style="display:none;">
			<h1>Local items</h1>
			<div class="dropdown">
				<button class="btn btn-primary dropdown-toggle" type="button" data-toggle="dropdown">Add a column
					<span class="caret"></span></button>
				<ul class="dropdown-menu">
					<li><a href="javascript:void(0)" onclick="jQuery('#viewTable').bootstrapTable('showColumn', 'country');">Country Of Origin</a></li>
					<li><a href="javascript:void(0)" onclick="jQuery('#viewTable').bootstrapTable('showColumn', 'year');">Year Of Origin</a></li>
					<li><a href="javascript:void(0)" onclick="jQuery('#viewTable').bootstrapTable('showColumn', 'view');">View</a></li>
				</ul>
			</div>
			<div class="table-responsive">
				<table align="center" id="viewTable" class="table table-bordered"></table>
			</div>
		</div>
	</script>

	<script type="text/ng-template" id="search.html">

		<div id="searchDiv" class="container">
			<h1>Search</h1>
			<form id="searchForm">
				<div class="form-group">
					<label for="name_search">Name</label>
					<input type="text" class="form-control" id="name_search" placeholder="Enter Stamp Name">
					<br>
					<label for="country_search">Country Of Origin</label>
					<input type="text" class="form-control" id="country_search" placeholder="Enter Country of Origin">
					<br>
					<label for="year_search">Year Of Origin</label>
					<input type="number" min="100" max="2017" class="form-control" id="year_search" placeholder="Enter Year Of Origin">
				</div>
				<button type="submit" class="btn btn-primary">Submit</button>
				<button type="reset" class="btn btn-primary">Reset</button>
			</form>
		</div>
		<div id="searchResults" class="container" style="display:none;">
			<button id="newSearch" onclick="$('#searchDiv')[0].style.display = 'block';$('#searchResults')[0].style.display = 'none'; $('#searchTable').bootstrapTable('removeAll');" class="btn btn-primary">New Search</button>
			<h1>Search Results</h1>
			<img id="photo_search" width="200" height="200" style="display:none;">
			<div class="dropdown">
				<button class="btn btn-primary dropdown-toggle" type="button" data-toggle="dropdown">Add a column
					<span class="caret"></span></button>
				<ul class="dropdown-menu">
					<li><a href="javascript:void(0)" onclick="jQuery('#searchTable').bootstrapTable('showColumn', 'country');">Country Of Origin</a></li>
					<li><a href="javascript:void(0)" onclick="jQuery('#searchTable').bootstrapTable('showColumn', 'year');">Year Of Origin</a></li>
					<li><a href="javascript:void(0)" onclick="jQuery('#searchTable').bootstrapTable('showColumn', 'view');">View</a></li>
				</ul>
			</div>
			<div class="table-responsive">
				<table align="center" id="searchTable" class="table table-bordered"></table>
			</div>
		</div>
	</script>
	<script type="text/ng-template" id="connections.html">
		<div class="container">
			<form id="connectForm">
				<div class="form-group">
					<label for="establishConnection">Connect To:</label>
					<input type="text" class="form-control" id="establishConnection" placeholder="Enter IDENTITY of user" required>
				</div>
				<button type="submit" class="btn btn-primary">Connect</button>
			</form>
			<br>
		</div>
		<div class="container">
			<div class="table-responsive">
				<table align="center" id="connectionsTable" class="table table-bordered"></table>
			</div>
		</div>
	</script>

	<script type="text/ng-template" id="error.html">
	<p align="center">OOP! An error occurred</p>
	</script>

	<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.0-rc.1/angular.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.0-rc.1/angular-route.js"></script>
    <script>

      angular.module('stampCollection.controllers', [])
		.controller('view', [function() {
		  setImmediate(() => {
            initializeTable("#viewTable")
            node.query({}).then((result) => parseAndAppendLocalData(result, "#viewTable"))
          })
		}])
        .controller('search', [function() {
          setImmediate(() => {
            initializeTable("#searchTable")
            $('#searchForm').submit(searchStamp)
          })
        }])
        .controller('create', [function() {
          setImmediate(() => {
            $('#createForm').submit(createStamp)
          })
        }])
        .controller('connections', [function() {
          setImmediate(() => {
            $('#connectForm').submit(function (e) {
              e.preventDefault();
              node.connect(jQuery('#establishConnection')[0].value)
                .then(() => refereshConnectionsTable())
            })
            initializeConnections()
          })
        }])
	  angular.module('stampCollection', ['ngRoute','stampCollection.controllers'])
			.config(function($routeProvider, $locationProvider){
				$routeProvider
					.when('/', {
						templateUrl: 'index.html'
					})
                  	.when('/home', {
                    	templateUrl: 'index.html'
                  	})
					.when('/create', {
						templateUrl: 'create.html',
                      controller: 'create'
                    })
				    .when('/view', {
					    templateUrl: 'view.html',
					  	controller: 'view'
					})
					.when('/search', {
					    templateUrl: 'search.html',
	                    controller: 'search'
                    })
                  .when('/connections', {
                    templateUrl: 'connections.html',
                    controller: 'connections'
                  })
					.otherwise({
						templateUrl: 'error.html'
					});
					//$locationProvider.html5Mode(true);

			})
			.run(function($rootScope, $location, $route) {
			  //console.log("DEBUG: Current path is "+ $location.path())
			});

        var node
        if (!node) {
          //console.log("creating new node")
          node = new MongoIdbDs2("stamps", "hash, name, country, year")
		  node.start().then(() => { $('#identity')[0].innerHTML = node.getIdentity()})
        }

	</script>
</html>
